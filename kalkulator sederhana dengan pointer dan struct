#include <stdio.h>
#include <stdlib.h>

typedef struct {
    double a;
    double b;
    char op;
    double result;
    int valid;
} Calc;

void compute(Calc *c) {
    c->valid = 1;
    switch (c->op) {
        case '+': c->result = c->a + c->b; break;
        case '-': c->result = c->a - c->b; break;
        case '*': c->result = c->a * c->b; break;
        case '/':
            if (c->b == 0.0) {
                c->valid = 0;
            } else {
                c->result = c->a / c->b;
            }
            break;
        default:
            c->valid = 0;
    }
}

void print_menu(void) {
    puts("\nKalkulator Sederhana");
    puts("Format input: <angka1> <operator> <angka2>");
    puts("Operator yang tersedia: +  -  *  /");
    puts("Ketik 'q' pada prompt operator untuk keluar.");
}

int main(void) {
    Calc calc;
    int keep_running = 1;

    print_menu();

    while (keep_running) {
        printf("\nMasukkan angka pertama: ");
        if (scanf("%lf", &calc.a) != 1) {
            printf("Input tidak valid. Coba lagi.\n");
            while (getchar() != '\n'); /* buang sisa baris */
            continue;
        }

        printf("Masukkan operator (+ - * /) atau q untuk keluar: ");
        if (scanf(" %c", &calc.op) != 1) {
            printf("Gagal membaca operator. Coba lagi.\n");
            while (getchar() != '\n');
            continue;
        }
        if (calc.op == 'q' || calc.op == 'Q') {
            puts("Keluar dari kalkulator. Sampai jumpa!");
            break;
        }

        printf("Masukkan angka kedua: ");
        if (scanf("%lf", &calc.b) != 1) {
            printf("Input tidak valid. Coba lagi.\n");
            while (getchar() != '\n');
            continue;
        }

        compute(&calc);

        if (!calc.valid) {
            if (calc.op == '/' && calc.b == 0.0) {
                puts("Error: pembagian dengan nol tidak diperbolehkan.");
            } else {
                puts("Error: operator tidak dikenali atau operasi tidak valid.");
            }
        } else {
            printf("Hasil: %.10g %c %.10g = %.10g\n", calc.a, calc.op, calc.b, calc.result);
        }

        while (getchar() != '\n');
    }

    return 0;
}
